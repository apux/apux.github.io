<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv='X-UA-Compatible' content='IE=edge;chrome=1' />
    <title>El Blog de ApuX - Struct and OpenStruct in Ruby</title>
    <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" />
    <link href="/stylesheets/all.css" rel="stylesheet" type="text/css" />
  </head>
  <body>
    <div id="main" role="main">
      <nav>
  <ul>
    <li>
<a class="blog-title" href="/">        El Blog de Ap<span>uX</span>
</a>      <span class="caption">My Learning about Software Development</span>
    </li>
  </ul>
</nav>

      <section id="content">
          <article>
    <h1 class="heading">
      Struct and OpenStruct in Ruby
      <time>Oct 14 2013</time>
    </h1>
    <p>The Ruby&rsquo;s <code>Struct</code> and <code>OpenStruct</code> classes are very useful for some tasks.
They act like a simple data structure, similar to hash, but they also allow to
access their attributes by calling them directly from the object and not only
using the brackets.</p>

<h1>Struct</h1>

<p>Let&rsquo;s see and example with <code>Struct</code>.</p>
<pre class="highlight ruby"><code><span class="no">Computer</span> <span class="o">=</span> <span class="no">Struct</span><span class="p">.</span><span class="nf">new</span> <span class="ss">:ram</span><span class="p">,</span> <span class="ss">:hard_disk</span>
<span class="n">computer</span> <span class="o">=</span> <span class="no">Computer</span><span class="p">.</span><span class="nf">new</span>
<span class="n">computer</span><span class="p">[</span><span class="ss">:ram</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"4 MB"</span>
<span class="n">computer</span><span class="p">.</span><span class="nf">hard_disk</span> <span class="o">=</span> <span class="s2">"500 GB"</span>

<span class="c1"># Access data with []</span>
<span class="n">computer</span><span class="p">[</span><span class="ss">:ram</span><span class="p">]</span>       <span class="c1"># =&gt; "4 MB"</span>
<span class="n">computer</span><span class="p">[</span><span class="ss">:hard_disk</span><span class="p">]</span> <span class="c1"># =&gt; "500 GB"</span>

<span class="c1"># Access data as attributes</span>
<span class="n">computer</span><span class="p">.</span><span class="nf">ram</span>       <span class="c1"># =&gt; "4 MB"</span>
<span class="n">computer</span><span class="p">.</span><span class="nf">hard_disk</span> <span class="c1"># =&gt; "500 GB"</span>
</code></pre>

<p>In line 1, we defined a struct indicating the attributes it will contain. This
instruction is very interesting: in theory, it should return a <code>Struct</code> object,
but it doesn&rsquo;t. Actually, it returns a <code>Class</code> object, the same type of object
that Ruby generates when a class is defined (yes, in Ruby, the class definition
is also an object, but we will not go into details for now). This object can be
assigned to a variable (or a constant, like in this case), and it is also
possible to generate objects from it, as we do in line 2. </p>

<p>In line 3, we assign a value to one of the attributes using the hash syntax,
and in the line 4 we do the same with the other attribute but using the method
syntax. The lines 7 and 8, and the lines 11 and 12 show that the data can be
accessed in both ways too.</p>

<p>Also, <code>Struct</code> allows to define methods as part of the structure. Let&rsquo;s see:</p>
<pre class="highlight ruby"><code><span class="no">Computer</span> <span class="o">=</span> <span class="no">Struct</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">:ram</span><span class="p">,</span> <span class="ss">:hard_disk</span><span class="p">)</span> <span class="k">do</span>
  <span class="k">def</span> <span class="nf">descripcion</span>
    <span class="s2">"Computer with </span><span class="si">#{</span><span class="n">ram</span><span class="si">}</span><span class="s2"> ram and </span><span class="si">#{</span><span class="n">hard_disk</span><span class="si">}</span><span class="s2"> hard disk."</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">computer</span> <span class="o">=</span> <span class="no">Computer</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s2">"4 MB"</span><span class="p">,</span> <span class="s2">"500 GB"</span><span class="p">)</span>
<span class="n">computer</span><span class="p">.</span><span class="nf">descripcion</span>
<span class="c1"># =&gt; Computer with 4 MB ram and 500 GB hard disk.</span>
</code></pre>

<p>In this example we can see how a method is defined in a <code>Struct</code> and also we
see that it is possible to create the object by indicating the values it will
contain, like if we defined an <code>initialize</code> method that receives these
parameters. The order of the values must match the order of the parameters
defined for the structure (see lines 1 and 7).</p>

<p>The params of <code>Struct</code> are not strict. If we declare that it receives 3 params
and when creating we only send 1, the remaining 2 are initialized with nil. On
the other hand, if we send more than 3 params, we get an exception.</p>
<pre class="highlight ruby"><code><span class="n">computer</span> <span class="o">=</span> <span class="no">Struct</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">:ram</span><span class="p">,</span> <span class="ss">:hard_disk</span><span class="p">,</span> <span class="ss">:processor</span><span class="p">).</span><span class="nf">new</span><span class="p">(</span><span class="s2">"4 MB"</span><span class="p">)</span>
<span class="c1"># =&gt; #&lt;struct ram="4 MB", hard_disk=nil, processor=nil&gt;</span>

<span class="n">computer</span> <span class="o">=</span> <span class="no">Struct</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">:ram</span><span class="p">).</span><span class="nf">new</span><span class="p">(</span><span class="s2">"4 MB"</span><span class="p">,</span> <span class="s2">"500 GB"</span><span class="p">,</span> <span class="s2">"2.5 GHz"</span><span class="p">,</span> <span class="s2">"1024x768"</span><span class="p">)</span>
<span class="c1"># =&gt; ArgumentError: struct size differs</span>
</code></pre>

<p>In the previous examples we can also see that it is possible to create
<code>Struct</code>&rsquo;s objects in a line.</p>

<p>As we can see, it is a very versatile class that allows us to create objects
with certain behavior with no need of creating a class for that.</p>

<h1>OpenStruct</h1>

<p><code>OpenStruct</code> behaves similarly, but it allows us to add attributes on the fly,
ie with no need to define them previously. Let&rsquo;s see the following example:</p>
<pre class="highlight ruby"><code><span class="nb">require</span> <span class="s1">'ostruct'</span>

<span class="n">computer</span> <span class="o">=</span> <span class="no">OpenStruct</span><span class="p">.</span><span class="nf">new</span> <span class="ss">ram: </span><span class="s1">'4 MB'</span><span class="p">,</span> <span class="ss">hard_disk: </span><span class="s1">'500 GB'</span>
<span class="n">computer</span><span class="p">.</span><span class="nf">ram</span> <span class="c1"># =&gt; '4 MB'</span>
<span class="n">computer</span><span class="p">[</span><span class="ss">:hard_disk</span><span class="p">]</span> <span class="c1"># =&gt; "500 GB"</span>

<span class="c1"># attributes can be created 'on the fly'</span>
<span class="n">computer</span><span class="p">.</span><span class="nf">screen</span> <span class="o">=</span> <span class="s2">"1024x768"</span>
<span class="n">computer</span><span class="p">.</span><span class="nf">screen</span>   <span class="c1"># =&gt; "1024x768"</span>
<span class="n">computer</span><span class="p">[</span><span class="ss">:screen</span><span class="p">]</span> <span class="c1"># =&gt; "1024x768"</span>
</code></pre>

<p>The first thing to note is that now we need to include the <code>ostruct</code> library
because it is not part of the <code>core</code> but of <code>stlib</code>; this is done in line 1. In
line 3 an <code>OpenStruct</code> object is created and initialized at the same time.
Unlike <code>Struct</code>, there is no intermediate class, but the created object
directly. To initialize it we can assign a hash directly, like in the example.
The lines 4 and 5 verify the values can be accessed the same way they can be
accessd with <code>Struct</code>.</p>

<p>In line 8 we assign a value to a no-defined attribute. We didn&rsquo;t indicate our
structure to accept values for <code>screen</code>, but <code>OpenStruct</code> knows how to handle
these cases by creating this attribute on the fly. In lines 9 and 10 we see it
is possible to access it with no problem.</p>

<p>Another important difference is that <code>OpenStruct</code> does not allow to define
methods in its declaration, as <code>Struct</code> does.</p>

<h1>Conclusions</h1>

<p>The classes <code>Struct</code> and <code>OpenStruct</code> provide a simple way to create data
structures with the behavior of a class. This is particulary useful when
refactoring and we are not sure about what new classes we need to create, then
we can use <code>Struct</code> or <code>OpenStruct</code> as an intermediate step. Obviously, if the
structure becomes more complex and requires more effort to be mantained, it is
time to move it to a real class.</p>

<p><code>OpenStruct</code>, besides not being part of the <code>core</code>, is slower than <code>Struct</code>,
thus we must prefer <code>Struct</code> whenever possible and use <code>OpenStruct</code> only when
necessary.</p>

<p>Here are the docs for <a href="http://www.ruby-doc.org/core-2.0/Struct.html">Struct</a>
and
<a href="http://www.ruby-doc.org/stdlib-2.0/libdoc/ostruct/rdoc/OpenStruct.html">OpenStruct</a>.</p>

  </article>
  <div id="disqus_thread"></div>
<script type="text/javascript">
//<![CDATA[
                  var disqus_shortname = 'elblogdeapux';
          
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
//]]>
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


      </section>
      <footer>
  <div class="container">
    <ul class="large-column">
      <li><h5 class="heading">Recent Articles</h5></li>
      <li>
        <ol>
            <li>
              <a href="/2015/11/11/how-to-install-zsh.html">How to Install Zsh</a>
              <span>Nov 11</span>
            </li>
            <li>
              <a href="/2015/08/31/how-to-install-postgresql-in-chakra-linux.html">How to Install Postgresql in Chakra Linux</a>
              <span>Aug 31</span>
            </li>
            <li>
              <a href="/2015/07/20/using-vim-regexp-to-update-to-rspec3-syntax.html">Using Vim Regexp to Update to RSpec 3 Syntax</a>
              <span>Jul 20</span>
            </li>
            <li>
              <a href="/2015/05/04/directory-tree.html">Directory tree</a>
              <span>May  4</span>
            </li>
            <li>
              <a href="/2015/04/13/directory-structure-conventions-in-rspec-and-minitest.html">Directory structure conventions in RSpec and Minitest</a>
              <span>Apr 13</span>
            </li>
            <li>
              <a href="/2015/01/12/joins-vs-includes-espanol.html">Joins vs Includes (Español)</a>
              <span>Jan 12</span>
            </li>
            <li>
              <a href="/2014/12/08/joins-vs-includes.html">Joins vs Includes</a>
              <span>Dec  8</span>
            </li>
            <li>
              <a href="/2014/09/01/minitest-v4-y-v5.html">Minitest v4 y  v5</a>
              <span>Sep  1</span>
            </li>
            <li>
              <a href="/2014/07/14/minitest-v4-and-v5.html">Minitest v4 and v5</a>
              <span>Jul 14</span>
            </li>
            <li>
              <a href="/2014/03/11/formularios-anidados.html">Formularios anidados</a>
              <span>Mar 11</span>
            </li>
        </ol>
      </li>
    </ul>

    <ul class="small-column">
      <li><h5 class="heading">Tags</h5></li>
      <li>
        <ol>
            <li><a href="/tags/rails.html">Rails (8)</a></li>
            <li><a href="/tags/activerecord.html">ActiveRecord (7)</a></li>
            <li><a href="/tags/nested_attributes.html">nested_attributes (1)</a></li>
            <li><a href="/tags/formularios.html">formularios (1)</a></li>
            <li><a href="/tags/ruby.html">Ruby (5)</a></li>
            <li><a href="/tags/struct.html">Struct (1)</a></li>
            <li><a href="/tags/openstruct.html">OpenStruct (1)</a></li>
            <li><a href="/tags/asociaciones.html">Asociaciones (1)</a></li>
            <li><a href="/tags/minitest.html">Minitest (3)</a></li>
            <li><a href="/tags/postgresql.html">postgresql (1)</a></li>
            <li><a href="/tags/chakra.html">chakra (1)</a></li>
            <li><a href="/tags/vim.html">vim (1)</a></li>
            <li><a href="/tags/regexp.html">regexp (1)</a></li>
            <li><a href="/tags/rspec.html">rspec (1)</a></li>
            <li><a href="/tags/rspec.html">RSpec (2)</a></li>
            <li><a href="/tags/tree.html">tree (1)</a></li>
        </ol>
      </li>
      <ul>
  </div>
</footer>

    </div>
  </body>
</html>
